<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fanzhh.pw","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="你曾经好奇过视频游戏是如何开发的吗？其实没有你想的那么难！现在就让我们动手开发一款游戏。">
<meta property="og:type" content="article">
<meta property="og:title" content="保护兔子宝宝！—— 使用python编写一个游戏">
<meta property="og:url" content="http://fanzhh.pw/2017/04/13/170420-python-pygame/index.html">
<meta property="og:site_name" content="Fanzhh&#39;s Blog">
<meta property="og:description" content="你曾经好奇过视频游戏是如何开发的吗？其实没有你想的那么难！现在就让我们动手开发一款游戏。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fanzhh.pw/images/idle.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/idle_1.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/pygame.PNG">
<meta property="og:image" content="https://koenig-media.raywenderlich.com/uploads/2012/11/NewImage.png">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game1.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game2.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game3.PNG">
<meta property="og:image" content="https://koenig-media.raywenderlich.com/uploads/2012/10/trig-lesson.png">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game4.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game5.png">
<meta property="og:image" content="http://binhaish.com/upfile/isClass/pic/20160906160342-1086094776.jpg">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game6.png">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game7.PNG">
<meta property="og:image" content="http://fanzhh.pw/images/170420_game8.PNG">
<meta property="article:published_time" content="2017-04-12T16:00:00.000Z">
<meta property="article:modified_time" content="2022-01-08T00:47:24.833Z">
<meta property="article:author" content="fanzhh">
<meta property="article:tag" content="python">
<meta property="article:tag" content="游戏">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fanzhh.pw/images/idle.PNG">

<link rel="canonical" href="http://fanzhh.pw/2017/04/13/170420-python-pygame/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>保护兔子宝宝！—— 使用python编写一个游戏 | Fanzhh's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Fanzhh's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://fanzhh.pw/2017/04/13/170420-python-pygame/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="fanzhh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fanzhh's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          保护兔子宝宝！—— 使用python编写一个游戏
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-13 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-13T00:00:00+08:00">2017-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 08:47:24" itemprop="dateModified" datetime="2022-01-08T08:47:24+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">技术笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>你曾经好奇过视频游戏是如何开发的吗？其实没有你想的那么难！现在就让我们动手开发一款游戏。<br><a id="more"></a></p>
<p>这篇文章的作者是一位时年仅13岁的python开发者，这是他的<a href="https://plus.google.com/u/0/117404693911977592313?rel=author" target="_blank">Google+</a>与<a href="https://twitter.com/jmeyer2k" target="_blank" rel="noopener">Twitter</a>账号。这篇文章原文在<a href="https://www.raywenderlich.com/24252/beginning-game-programming-for-teens-with-python" target="_blank" rel="noopener">这儿</a>。原来的代码基于python v2.7，翻译时略有改动，以适应python v3.2。</p>
<p>在这篇教程中，你将创建一个叫做兔子与獾的游戏。游戏中的英雄——兔子妈妈，将抵抗成群结队的獾的进攻，保卫堡垒中的兔子宝宝。</p>
<p>这个游戏使用Python，当然，这儿我不是指蛇（python英文原意为蟒蛇）! :]</p>
<p>Python是一种计算机语言。这个教程中我们选择Python，因为这种语言对于编程初学者来说很简单，而且学起来容易而有趣。</p>
<p>如果你对Python很陌生，那么编写这个游戏前，你应该具备一些Python基础知识。</p>
<h2 id="开始：安装Python"><a href="#开始：安装Python" class="headerlink" title="开始：安装Python"></a>开始：安装Python</h2><p>如果你使用的是Linux系统（如Ubuntu），那么你的电脑中已经内置有python了。如果你用的是windows系统，那么你要安装Python。你可以访问<a href="https://www.python.org/" target="_blank" rel="noopener">Python官网</a>下载最新版（译注：目前最新版本是v3.6.1，但目前pygame在windows下只支持v3.2，如果你的操作系统是windows我建议你点击<a href="https://www.python.org/ftp/python/3.2.3/python-3.2.3.msi" target="_blank" rel="noopener">这儿</a>下载并安装v3.2版本）。安装完成后，在<code>开始</code>菜单<code>所有程序</code>中你应该可以找到IDLE，单击它，如果安装正确，你将会看到以下画面：</p>
<p><img src="/images/idle.PNG" alt="IDLE"></p>
<p>进入IDLE之后，你可以测试Python能不能正确工作，输入<code>print(1+1)</code>然后回车试一试。Python会返回<code>2</code>。恭喜你，你刚刚写完了你的第一个Python程序！</p>
<p><img src="/images/idle_1.PNG" alt=""></p>
<p>现在你已经成功安装了Python并运行了第一个程序，为了用Python写游戏，你还需要安装<a href="http://www.pygame.org" target="_blank" rel="noopener">PyGame</a>（译注：单击<a href="http://pygame.org/ftp/pygame-1.9.2a0.win32-py3.2.msi" target="_blank" rel="noopener">这儿</a>直接下载安装包运行安装，注意安装时要选择你的Python安装目录）。</p>
<p>为了验证你的PyGame安装正确，打开IDLE输入<code>import pygame</code>并回车。如果没有返回任何结果，那么恭喜你，你的PyGame安装正确。</p>
<p><img src="/images/pygame.PNG" alt=""></p>
<h2 id="运行存储在文件中的Python代码"><a href="#运行存储在文件中的Python代码" class="headerlink" title="运行存储在文件中的Python代码"></a>运行存储在文件中的Python代码</h2><p>现在，你可以在IDLE中运行Python程序了。但是，如果你想运行代码比较多的程序（例如游戏），你需要把你的程序代码存储到磁盘上的文件中，这样，再次运行的时候，你就不需要在IDLE中一遍又一遍的输入啦。</p>
<p>运行文件中的Python代码有好几种方法。我们使用这种方法：在IDEL编辑器中运行代码。在这个教程中，我们将用这种方式。运行IDLE，你只需要在开始菜单中输入idle并回车。然后在IDEL菜单中选择File\New，会有一个文本编辑器窗口打开，你可以在这儿输入代码啦。如果要保存的话，选择<code>File</code>菜单中的<code>Save</code>；如果要运行，点击<code>Run</code>菜单下的<code>Run Module</code>（快捷键为F5）。也许你注意到了，<code>Run</code>菜单只有在你打开代码文件时才有效。</p>
<h2 id="添加游戏资源"><a href="#添加游戏资源" class="headerlink" title="添加游戏资源"></a>添加游戏资源</h2><p>现在你几乎马上就可以开始编写游戏啦。但是，如果游戏没有画面和音效是不是太逊了？我已经把设计游戏中需要用到的图片和声音文件打包成一个zip压缩包，你可以点击<a href="http://www.raywenderlich.com/downloads/BB_Resources.zip" target="_blank" rel="noopener">这儿</a>下载。下载之后，在你的硬盘上为你的游戏创建一个文件夹，将刚下载的压缩文件解压到这个文件夹里，你这样你游戏文件夹中有个子文件夹<code>resources</code>，文件夹的结构如下图：</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2012/11/NewImage.png" alt=""></p>
<p>现在，你可以开始编写你的兔子与獾游戏啦！</p>
<h2 id="第一步：哈罗，兔子！"><a href="#第一步：哈罗，兔子！" class="headerlink" title="第一步：哈罗，兔子！"></a>第一步：哈罗，兔子！</h2><p>运行IDLE并且打开一个文本编辑窗口，输入以下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 - 导入pygame库</span></span><br><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">from</span> pygame.locals <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 - 初始化游戏</span></span><br><span class="line">pygame.init()</span><br><span class="line">width, height = <span class="number">640</span>, <span class="number">480</span></span><br><span class="line">screen=pygame.display.set_mode((width, height))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 - 加载图像</span></span><br><span class="line">player = pygame.image.load(<span class="string">"resources/images/dude.png"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 - 保持循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># 5 - 在绘制图像之前先清除屏幕</span></span><br><span class="line">    screen.fill(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 6 - 绘制屏幕上的部件</span></span><br><span class="line">    screen.blit(player, (<span class="number">100</span>,<span class="number">100</span>))</span><br><span class="line">    <span class="comment"># 7 - 更新屏幕</span></span><br><span class="line">    pygame.display.flip()</span><br><span class="line">    <span class="comment"># 8 - 在事件之间循环</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="comment"># 检查是不是关闭按钮按下 </span></span><br><span class="line">        <span class="keyword">if</span> event.type==pygame.QUIT:</span><br><span class="line">            <span class="comment"># 如果是，退出游戏</span></span><br><span class="line">            pygame.quit() </span><br><span class="line">            exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>在你的游戏文件夹中保存这个文件，文件名为game.py。</p>
<p>让我们分析这段代码：</p>
<ol>
<li>导入PyGame库，导入后我们才可以在后面的程序用使用这个库的功能。</li>
<li>初始化游戏，设置游戏窗口的尺寸。</li>
<li>加载兔子图像。</li>
<li>在缩进代码中保持循环。<blockquote>
<p>注意：其他编程语言像java、C或PHP，使用括号来标识一段循环或条件判断中的代码块，Python使用缩进来标明代码块。所以正确的缩进非常重要，一定要记住。</p>
</blockquote>
</li>
<li>在绘制图像之前用黑色填充屏幕。</li>
<li>在x=100，y=100位置显示兔子。</li>
<li>更新屏幕。</li>
<li>检查事件， 如果事件是退出命令，退出程序。</li>
</ol>
<p>如果你现在运行程序，你会看到下面的屏幕：</p>
<p><img src="/images/170420_game1.PNG" alt=""></p>
<p>兔子准备好了，随时准备攻击！但是黑色屏幕上一只孤零零的兔子，看起来很可怜。让我们在增加一点东西。</p>
<h2 id="第二步：添加舞台布景"><a href="#第二步：添加舞台布景" class="headerlink" title="第二步：添加舞台布景"></a>第二步：添加舞台布景</h2><p>我们先为游戏增加背景。通过调用<code>screen.blit()</code>可以做到。</p>
<p>在#3末尾，加载图像之后，增加下面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grass = pygame.image.load(<span class="string">"resources/images/grass.png"</span>)</span><br><span class="line">castle = pygame.image.load(<span class="string">"resources/images/castle.png"</span>)</span><br></pre></td></tr></table></figure>
<p>这段代码加载草地和兔子堡垒的图像，然后存储到变量中。现在应该把它们绘制到屏幕上。但现在如果你检查草地图像，会发现它没有覆盖整个屏幕（屏幕尺寸设置为640x480）。这意味着你不得不把草地图片铺满整个屏幕。</p>
<p>在#6下面增加以下代码（在绘制玩家之前）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">for</span> x <span class="keyword">in</span> range(int(width/grass.get_width())+<span class="number">1</span>):</span><br><span class="line">     <span class="keyword">for</span> y <span class="keyword">in</span> range(int(height/grass.get_height())+<span class="number">1</span>):</span><br><span class="line">         screen.blit(grass,(x*<span class="number">100</span>,y*<span class="number">100</span>))</span><br><span class="line">screen.blit(castle,(<span class="number">0</span>,<span class="number">30</span>))</span><br><span class="line">screen.blit(castle,(<span class="number">0</span>,<span class="number">135</span>))</span><br><span class="line">screen.blit(castle,(<span class="number">0</span>,<span class="number">240</span>))</span><br><span class="line">screen.blit(castle,(<span class="number">0</span>,<span class="number">345</span> ))</span><br></pre></td></tr></table></figure>
<p>像你看到的那样，<code>for</code>首先循环<code>x</code>次，然后在这个循环里，它又循环<code>y</code>次，绘制草地图像。下面的几段代码在屏幕上绘制四个兔子堡垒。</p>
<p>如果你现在运行程序，看上去应该像这样：</p>
<p><img src="/images/170420_game2.PNG" alt=""></p>
<p>看起来好多了吧？</p>
<h2 id="第三步：让兔子动起来"><a href="#第三步：让兔子动起来" class="headerlink" title="第三步：让兔子动起来"></a>第三步：让兔子动起来</h2><p>接下来，您需要添加一些实际的游戏元素，例如让兔子响应按键。</p>
<p>要做到这一点，首先你会实现一个很好的方法，用来跟踪在给定的时刻哪些键按下了。 你可以简单地做一个关键状态的数组，来保存每个要用于游戏的键的状态。</p>
<p>在第#2节末尾添加以下代码到game.py（设置屏幕高度和宽度后）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keys = [<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span>]</span><br><span class="line">playerpos=[<span class="number">100</span>,<span class="number">100</span>]</span><br></pre></td></tr></table></figure>
<p>这段代码非常简单。 按键数组按照以下顺序跟踪被按下的键：WASD。数组中的每个项目对应一个键 - 第一个为W，第二个为A，等等。</p>
<p>playerpos变量是程序绘制游戏玩家的位置。由于游戏会将玩家移动到不同的位置，所以设置一个包含玩家位置的变量，然后简单地在不同位置绘制这个变量。</p>
<p>现在您需要修改现有的代码来绘制玩家以使用新的playerpos变量。 更改第6节中的以下行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen.blit(player, (<span class="number">100</span>,<span class="number">100</span>))</span><br></pre></td></tr></table></figure>
<p>更改为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen.blit(player, playerpos)</span><br></pre></td></tr></table></figure>
<p>接下来，根据按下哪个键更新键数组。PyGame通过添加event.key功能使检测按键更容易。</p>
<p>在＃8的末尾，在检查<code>event.type == pygame.QUIT</code>之后，增加以下代码（与pygame.QUIT相同的缩进级别）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> event.type == pygame.KEYDOWN:</span><br><span class="line">    <span class="keyword">if</span> event.key==K_w:</span><br><span class="line">        keys[<span class="number">0</span>]=<span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==K_a:</span><br><span class="line">        keys[<span class="number">1</span>]=<span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==K_s:</span><br><span class="line">        keys[<span class="number">2</span>]=<span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==K_d:</span><br><span class="line">        keys[<span class="number">3</span>]=<span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> event.type == pygame.KEYUP:</span><br><span class="line">    <span class="keyword">if</span> event.key==pygame.K_w:</span><br><span class="line">        keys[<span class="number">0</span>]=<span class="literal">False</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==pygame.K_a:</span><br><span class="line">        keys[<span class="number">1</span>]=<span class="literal">False</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==pygame.K_s:</span><br><span class="line">        keys[<span class="number">2</span>]=<span class="literal">False</span></span><br><span class="line">    <span class="keyword">elif</span> event.key==pygame.K_d:</span><br><span class="line">        keys[<span class="number">3</span>]=<span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>哇！很多代码行!其实如果你把它分解成if语句，并不是那么复杂。</p>
<p>首先，您检查一下按键是否被按下或释放。 然后您检查按下或释放了哪个键，如果按下或释放的键是您正在使用的键之一，则相应地更新键变量。</p>
<p>最后，您需要根据按键更新playerpos变量。 这其实很简单。</p>
<p>将以下代码添加到game.py的末尾（一个缩进，将其放在与for循环相同的级别）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9 - Move player</span></span><br><span class="line"><span class="keyword">if</span> keys[<span class="number">0</span>]:</span><br><span class="line">    playerpos[<span class="number">1</span>]-=<span class="number">5</span></span><br><span class="line"><span class="keyword">elif</span> keys[<span class="number">2</span>]:</span><br><span class="line">    playerpos[<span class="number">1</span>]+=<span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> keys[<span class="number">1</span>]:</span><br><span class="line">    playerpos[<span class="number">0</span>]-=<span class="number">5</span></span><br><span class="line"><span class="keyword">elif</span> keys[<span class="number">3</span>]:</span><br><span class="line">    playerpos[<span class="number">0</span>]+=<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>该代码简单地检查按下哪个键，并从兔子的x或y位置添加或减去（取决于按下的键）5来移动玩家。</p>
<p>运行游戏，你应该像以前一样得到一个兔子。尝试按WASD。 好极了！ 对吧？</p>
<p><img src="/images/170420_game3.PNG" alt=""></p>
<h2 id="第四步：旋转玩家"><a href="#第四步：旋转玩家" class="headerlink" title="第四步：旋转玩家"></a>第四步：旋转玩家</h2><p>是的，当你按键你的兔子现在会移动，如果你可以使用鼠标旋转兔子面对你选择的方向，那就更酷了，所以它不就不会一直朝向同一个方向了？使用三角函数可以很容易地实现。</p>
<p>看下图：</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2012/10/trig-lesson.png" alt=""></p>
<p>在上述图像中，如果（5,3）是兔子的位置，(2,4）是鼠标的当前位置，则可以通过将atan2三角函数应用于差两点之间的距离来找到旋转角度（z）。当然，一旦你知道旋转角度，你可以简单地旋转兔子。 ：]</p>
<p>如果你对这部分有些困惑，别担心 —— 你可以继续下去。但这就是为什么你应该在数学课上注意！ ：]你会一直在游戏编程中使用这些东西。</p>
<p>现在你需要把这个概念应用到你的游戏中。 为此，您可以使用PyGame <code>Surface.rotate</code>（度）函数。 顺便说一句，请记住，Z值是弧度。 ：[</p>
<p><code>atan2</code>函数来自Python数学库。 所以首先添加到第1节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br></pre></td></tr></table></figure>
<p>然后，用以下代码替换#6中的最后一行（player.blit）:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.1 - Set player position and rotation</span></span><br><span class="line">position = pygame.mouse.get_pos()</span><br><span class="line">angle = math.atan2(position[<span class="number">1</span>]-(playerpos[<span class="number">1</span>]+<span class="number">32</span>),position[<span class="number">0</span>]-(playerpos[<span class="number">0</span>]+<span class="number">26</span>))</span><br><span class="line">playerrot = pygame.transform.rotate(player, <span class="number">360</span>-angle*<span class="number">57.29</span>)</span><br><span class="line">playerpos1 = (playerpos[<span class="number">0</span>]-playerrot.get_rect().width/<span class="number">2</span>, playerpos[<span class="number">1</span>]-playerrot.get_rect().height/<span class="number">2</span>)</span><br><span class="line">screen.blit(playerrot, playerpos1)</span><br></pre></td></tr></table></figure>
<p>我们来看一下上述代码的基本结构。首先你会得到鼠标和兔子的位置。然后你把这些输入atan2功能。之后，您将从atan2功能接收到的角度从弧度转换为度数（乘以弧度大约为57.29或360/2π）。</p>
<p>由于兔子会旋转，它的位置会改变。所以现在你计算出新的兔子的位置，并在屏幕上显示兔子。</p>
<p>再次运行游戏。如果您只使用WASD键，那么游戏应该像以前一样。但如果你移动鼠标，兔子也会旋转。酷！</p>
<p><img src="/images/170420_game4.PNG" alt=""></p>
<h2 id="第五步：射击，兔子，射击！"><a href="#第五步：射击，兔子，射击！" class="headerlink" title="第五步：射击，兔子，射击！"></a>第五步：射击，兔子，射击！</h2><p>现在你的兔子移动了，现在是添加一点点动作的时候了。 ：] 如何让兔子用箭射杀入侵的敌人？这不是一只温和的兔子！</p>
<p>这个步骤有点复杂，因为你必须跟踪所有的箭，更新它们，旋转它们，并在屏幕外删除它们。</p>
<p>首先，将必要的变量添加到#2初始化部分的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acc=[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">arrows=[]</span><br></pre></td></tr></table></figure>
<p>第一个变量跟踪播放器的准确度，第二个数组跟踪所有的箭。精确度变量（acc）本质上是发射射击次数和击中獾数量的数组。之后，我们将使用这些信息来计算准确率。</p>
<p>接下来，在第#3节末尾的加载箭头图像：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrow = pygame.image.load(<span class="string">"resources/images/bullet.png"</span>)</span><br></pre></td></tr></table></figure>
<p>现在当用户点击鼠标时，需要发射箭头。将以下内容添加到第#8节末尾作为新的事件处理程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> event.type==pygame.MOUSEBUTTONDOWN:</span><br><span class="line">    position=pygame.mouse.get_pos()</span><br><span class="line">    acc[<span class="number">1</span>]+=<span class="number">1</span></span><br><span class="line">    arrows.append([math.atan2(position[<span class="number">1</span>]-(playerpos1[<span class="number">1</span>]+<span class="number">32</span>),position[<span class="number">0</span>]-(playerpos1[<span class="number">0</span>]+<span class="number">26</span>)),playerpos1[<span class="number">0</span>]+<span class="number">32</span>,playerpos1[<span class="number">1</span>]+<span class="number">32</span>])</span><br></pre></td></tr></table></figure>
<p>该代码检查鼠标是否被点击，如果是，它会获取鼠标位置，并根据旋转的兔子位置和鼠标位置计算箭头旋转。 该旋转值存储在箭头数组中。</p>
<p>接下来，你必须在画面上画箭头。在第6.1节之后添加以下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.2 - Draw arrows</span></span><br><span class="line"><span class="keyword">for</span> bullet <span class="keyword">in</span> arrows:</span><br><span class="line">    index=<span class="number">0</span></span><br><span class="line">    velx=math.cos(bullet[<span class="number">0</span>])*<span class="number">10</span></span><br><span class="line">    vely=math.sin(bullet[<span class="number">0</span>])*<span class="number">10</span></span><br><span class="line">    bullet[<span class="number">1</span>]+=velx</span><br><span class="line">    bullet[<span class="number">2</span>]+=vely</span><br><span class="line">    <span class="keyword">if</span> bullet[<span class="number">1</span>]&lt;<span class="number">-64</span> <span class="keyword">or</span> bullet[<span class="number">1</span>]&gt;<span class="number">640</span> <span class="keyword">or</span> bullet[<span class="number">2</span>]&lt;<span class="number">-64</span> <span class="keyword">or</span> bullet[<span class="number">2</span>]&gt;<span class="number">480</span>:</span><br><span class="line">        arrows.pop(index)</span><br><span class="line">    index+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> projectile <span class="keyword">in</span> arrows:</span><br><span class="line">        arrow1 = pygame.transform.rotate(arrow, <span class="number">360</span>-projectile[<span class="number">0</span>]*<span class="number">57.29</span>)</span><br><span class="line">        screen.blit(arrow1, (projectile[<span class="number">1</span>], projectile[<span class="number">2</span>]))</span><br></pre></td></tr></table></figure>
<p>使用基本三角法计算vely和velx值。10是箭头的速度。if语句只是检查箭头是否超出范围，如果是，它会删除箭头。第二个语句循环所有的箭头，并以正确的旋转绘制它们。</p>
<p>尝试并运行该程序。你应该有一个兔子，当你点击鼠标时它会射出箭！ ：D</p>
<p><img src="/images/170420_game5.png" alt=""></p>
<h2 id="第六步：拿起武器！獾！"><a href="#第六步：拿起武器！獾！" class="headerlink" title="第六步：拿起武器！獾！"></a>第六步：拿起武器！獾！</h2><p>好的，你有一座城堡，你有一个可以移动和射击的英雄。那么少了什么？攻击英雄防护的城堡的敌人！</p>
<p><img src="http://binhaish.com/upfile/isClass/pic/20160906160342-1086094776.jpg" alt=""></p>
<p>在此步骤中，您将创建随机生成的向城堡进攻的。游戏进行中，会有越来越多的獾。所以，让我们列出你需要做什么。</p>
<ol>
<li>将坏人添加到列表中。</li>
<li>更新每个帧中的坏家伙数组，并检查他们是否走到屏幕以外。</li>
<li>显示坏人。</li>
</ol>
<p>轻松吧？ ：]</p>
<p>首先，将以下代码添加到第#2节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">badtimer=<span class="number">100</span></span><br><span class="line">badtimer1=<span class="number">0</span></span><br><span class="line">badguys=[[<span class="number">640</span>,<span class="number">100</span>]]</span><br><span class="line">healthvalue=<span class="number">194</span></span><br></pre></td></tr></table></figure>
<p>以上设置了一个计时器（以及一些其他值），以便游戏在运行一段时间后添加新的獾。你在每一帧不断减少badtimer数值，直到它为零，然后产生一个新的獾。</p>
<p>现在将以下内容添加到第#3节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">badguyimg1 = pygame.image.load(<span class="string">"resources/images/badguy.png"</span>)</span><br><span class="line">badguyimg=badguyimg1</span><br></pre></td></tr></table></figure>
<p>上面的第一行类似于所有以前的图像加载代码。第二行设置图像的副本，以便您可以更轻松地为坏人制作动画。</p>
<p>接下来，你必须更新并显示坏人。在第#6.2节之后添加此代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.3 - Draw badgers</span></span><br><span class="line"><span class="keyword">if</span> badtimer==<span class="number">0</span>:</span><br><span class="line">    badguys.append([<span class="number">640</span>, random.randint(<span class="number">50</span>,<span class="number">430</span>)])</span><br><span class="line">    badtimer=<span class="number">100</span>-(badtimer1*<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> badtimer1&gt;=<span class="number">35</span>:</span><br><span class="line">        badtimer1=<span class="number">35</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        badtimer1+=<span class="number">5</span></span><br><span class="line">index=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> badguy <span class="keyword">in</span> badguys:</span><br><span class="line">    <span class="keyword">if</span> badguy[<span class="number">0</span>]&lt;<span class="number">-64</span>:</span><br><span class="line">        badguys.pop(index)</span><br><span class="line">    badguy[<span class="number">0</span>]-=<span class="number">7</span></span><br><span class="line">    index+=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> badguy <span class="keyword">in</span> badguys:</span><br><span class="line">    screen.blit(badguyimg, badguy)</span><br></pre></td></tr></table></figure>
<p>许多代码。：] 第一行检查badtimer是否为零，如果是，创建一个獾，并根据到目前为止运行badtimer多少次，再次设置badtimer。第一个for循环更新獾的x位置，检查獾是否离开屏幕，并且如果在屏幕外，则会删除獾。第二个循环绘制所有的獾。</p>
<p>为了在上面的代码中使用随机函数，你还需要导入随机库。因此，将以下内容添加到第#1节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure>
<p>最后，在while语句（第#4节）之后添加这一行，以减少每一帧的badtimer的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">badtimer-=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>通过运行游戏来尝试所有这些代码。现在你应该开始看到真正的游戏 —— 你可以射击，移动，转身和獾们试图跑到你身边。</p>
<p><img src="/images/170420_game6.png" alt=""></p>
<p>可是等等！ 为什么獾们扑向城堡？让我们快点添加一下…</p>
<p>在第#6.3节第一个for循环的<code>index+=1</code>之前添加此代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.3.1 - Attack castle</span></span><br><span class="line">badrect=pygame.Rect(badguyimg.get_rect())</span><br><span class="line">badrect.top=badguy[<span class="number">1</span>]</span><br><span class="line">badrect.left=badguy[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> badrect.left&lt;<span class="number">64</span>:</span><br><span class="line">    healthvalue -= random.randint(<span class="number">5</span>,<span class="number">20</span>)</span><br><span class="line">    badguys.pop(index)</span><br><span class="line"><span class="comment"># 6.3.3 - Next bad guy</span></span><br></pre></td></tr></table></figure>
<p>这段代码很简单。如果獾的x值小于64，则删除该坏人，并将游戏健康值降低5到20之间的随机值（稍后将显示当前的健康值）。</p>
<p>如果你建立和运行程序，你应该得到一堆攻击的獾，当他们击中城堡时消失。 虽然你看不到，但是獾们实际上z在降低你的健康值。</p>
<h2 id="第七步：獾与箭的碰撞"><a href="#第七步：獾与箭的碰撞" class="headerlink" title="第七步：獾与箭的碰撞"></a>第七步：獾与箭的碰撞</h2><p>獾们攻击你的城堡，但你的箭对他们没有影响！兔子应该如何保卫自己的家？</p>
<p>是时候设置箭头杀死獾了，然后你可以保护城堡，赢得比赛！基本上，你必须在每一个循环里循环遍历所有的坏家伙，循环遍历所有的箭头，并检查它们是否碰撞。如果他们碰撞了，那么删除獾，删除箭头，并将你的准确率加一。</p>
<p>在第#6.3.1节之后，添加：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6.3.2 - Check for collisions</span></span><br><span class="line">index1=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> bullet <span class="keyword">in</span> arrows:</span><br><span class="line">    bullrect=pygame.Rect(arrow.get_rect())</span><br><span class="line">    bullrect.left=bullet[<span class="number">1</span>]</span><br><span class="line">    bullrect.top=bullet[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> badrect.colliderect(bullrect):</span><br><span class="line">        acc[<span class="number">0</span>]+=<span class="number">1</span></span><br><span class="line">        badguys.pop(index)</span><br><span class="line">        arrows.pop(index1)</span><br><span class="line">    index1+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>在这段代码中只需要注意一点。if语句中是一个内置的PyGame函数，用于检查两个矩形是否相交。其他几行代码我上面已经解释过。</p>
<p>现在如果你运行这个程序，你应该能够射击和杀死獾。</p>
<h2 id="第八步：添加健康计时器和时钟"><a href="#第八步：添加健康计时器和时钟" class="headerlink" title="第八步：添加健康计时器和时钟"></a>第八步：添加健康计时器和时钟</h2><p>游戏进度相当不错。你有你的攻击者，你有你的防守者。现在你需要的只是一种累计分数并显示兔子做得很好的方法。</p>
<p>最简单的方法是添加一个显示城堡当前运行状况的HUD（头像显示）。您还可以添加时钟来显示城堡已经存活多久。</p>
<p>先添加时钟。 在＃7开头之前添加以下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.4 - Draw clock</span></span><br><span class="line">font = pygame.font.Font(<span class="literal">None</span>, <span class="number">24</span>)</span><br><span class="line">survivedtext = font.render(str((<span class="number">90000</span>-pygame.time.get_ticks())/<span class="number">60000</span>)+<span class="string">":"</span>+str((<span class="number">90000</span>-pygame.time.get_ticks())/<span class="number">1000</span>%<span class="number">60</span>).zfill(<span class="number">2</span>), <span class="literal">True</span>, (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">textRect = survivedtext.get_rect()</span><br><span class="line">textRect.topright=[<span class="number">635</span>,<span class="number">5</span>]</span><br><span class="line">screen.blit(survivedtext, textRect)</span><br></pre></td></tr></table></figure>
<p>上述代码使用默认的PyGame字体设置创建一个新的字体，字体大小为24。然后使用该字体将时间的文本渲染到屏幕上。之后，文本在屏幕上定位和绘制。</p>
<p>接下来添加健康栏。但在绘制健康条之前，您需要加载条形图像。将以下代码添加到第#3节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">healthbar = pygame.image.load(<span class="string">"resources/images/healthbar.png"</span>)</span><br><span class="line">health = pygame.image.load(<span class="string">"resources/images/health.png"</span>)</span><br></pre></td></tr></table></figure>
<p>第一个是用于完整健康值的红色图像。第二个是用于显示当前健康水平的绿色图像。</p>
<p>现在在第#6.4节（您刚添加的）之后添加以下代码，以在屏幕上绘制健康条：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.5 - Draw health bar</span></span><br><span class="line">screen.blit(healthbar, (<span class="number">5</span>,<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> health1 <span class="keyword">in</span> range(healthvalue):</span><br><span class="line">    screen.blit(health, (health1+<span class="number">8</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>
<p>代码首先绘制全红的健康栏。然后，根据城堡剩余的生命，它在健康栏上画一定数量的绿色。</p>
<p>如果你建立并运行程序，你应该有一个计时器和一个健康条了。</p>
<p><img src="/images/170420_game7.PNG" alt=""></p>
<h2 id="第九步：胜利或失败"><a href="#第九步：胜利或失败" class="headerlink" title="第九步：胜利或失败"></a>第九步：胜利或失败</h2><p>但是怎么回事？如果你玩得时间足够长，即使你的健康状况下降到零，游戏还会继续下去！不仅如此，你也可以继续在獾们身上射击。那不行，现在呢？你需要一些胜利/失败的场景，使游戏值得玩。</p>
<p>所以让我们添加胜利与失败的条件以及显示赢或输结果的屏幕。 ：] 你通过退出主循环进入一个赢/输循环实现。 在赢/输循环中，您必须弄清楚用户是赢还是输，并相应地显示屏幕。</p>
<p>这是一个基本的失败场景：</p>
<p>如果时间到了（90000毫秒或90秒），那么：</p>
<ul>
<li>停止运行游戏</li>
<li>将比赛的结果设为1或赢</li>
</ul>
<p>如果城堡被毁了，那么：</p>
<ul>
<li>停止运行游戏</li>
<li>将比赛的结果设为1或赢</li>
</ul>
<p>以任一方式计算准确度。</p>
<blockquote>
<p>注意：<code>acc[0]*1.0</code>只是将<code>acc[0]</code>转换成float。如果不这样做，则除法操作数将返回像1或2这样的整数，而不是1.5。</p>
</blockquote>
<p>在game.py末尾添加以下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">#10 - 输赢检查</span></span><br><span class="line">    <span class="keyword">if</span> pygame.time.get_ticks()&gt;=<span class="number">90000</span>:</span><br><span class="line">        running=<span class="number">0</span></span><br><span class="line">        exitcode=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> healthvalue&lt;=<span class="number">0</span>:</span><br><span class="line">        running=<span class="number">0</span></span><br><span class="line">        exitcode=<span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> acc[<span class="number">1</span>]!=<span class="number">0</span>:</span><br><span class="line">        accuracy=acc[<span class="number">0</span>]*<span class="number">1.0</span>/acc[<span class="number">1</span>]*<span class="number">100</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        accuracy=<span class="number">0</span></span><br><span class="line"><span class="comment"># 11 - 显示输赢        </span></span><br><span class="line"><span class="keyword">if</span> exitcode==<span class="number">0</span>:</span><br><span class="line">    pygame.font.init()</span><br><span class="line">    font = pygame.font.Font(<span class="literal">None</span>, <span class="number">24</span>)</span><br><span class="line">    text = font.render(<span class="string">"Accuracy: "</span>+str(accuracy)+<span class="string">"%"</span>, <span class="literal">True</span>, (<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    textRect = text.get_rect()</span><br><span class="line">    textRect.centerx = screen.get_rect().centerx</span><br><span class="line">    textRect.centery = screen.get_rect().centery+<span class="number">24</span></span><br><span class="line">    screen.blit(gameover, (<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    screen.blit(text, textRect)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    pygame.font.init()</span><br><span class="line">    font = pygame.font.Font(<span class="literal">None</span>, <span class="number">24</span>)</span><br><span class="line">    text = font.render(<span class="string">"Accuracy: "</span>+str(accuracy)+<span class="string">"%"</span>, <span class="literal">True</span>, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>))</span><br><span class="line">    textRect = text.get_rect()</span><br><span class="line">    textRect.centerx = screen.get_rect().centerx</span><br><span class="line">    textRect.centery = screen.get_rect().centery+<span class="number">24</span></span><br><span class="line">    screen.blit(youwin, (<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    screen.blit(text, textRect)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            pygame.quit()</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    pygame.display.flip()</span><br></pre></td></tr></table></figure>
<p>这是最长的代码了！但并不复杂。</p>
<p>第一个if语句检查时间是否满足。第二个检查城堡是否被毁坏。第三个计算您的准确率。之后，if语句检查您是否赢了或失败并显示对应的图像。</p>
<p>当然，如果要显示失败或胜利的图像，则必须首先加载这些图像。 因此，将以下代码添加到第#3节的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gameover = pygame.image.load(<span class="string">"resources/images/gameover.png"</span>)</span><br><span class="line">youwin = pygame.image.load(<span class="string">"resources/images/youwin.png"</span>)</span><br></pre></td></tr></table></figure>
<p>还有一件简单的工作，把#4从：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 4 - 保持循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    badtimer-=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4 - 保持循环</span></span><br><span class="line">running = <span class="number">1</span></span><br><span class="line">exitcode = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> running:</span><br><span class="line">    badtimer-=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>运行变量跟踪游戏是否结束，退出代码变量跟踪玩家是赢或输。</p>
<p>再次运行游戏，现在你可以胜利或死亡！ ：]</p>
<p><img src="/images/170420_game8.PNG" alt=""></p>
<h2 id="第十步：音乐和声音效果！"><a href="#第十步：音乐和声音效果！" class="headerlink" title="第十步：音乐和声音效果！"></a>第十步：音乐和声音效果！</h2><p>游戏看起来很不错，但是怎么回事？有点安静，不是吗？添加一些音效可以改变游戏的感觉。</p>
<p>PyGame使加载和播放声音超级简单。首先，您必须在第#2节末尾加入调音台：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pygame.mixer.init()</span><br></pre></td></tr></table></figure>
<p>然后在#3末尾加载声音，设置音量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.1 - 加载音频</span></span><br><span class="line">hit = pygame.mixer.Sound(<span class="string">"resources/audio/explode.wav"</span>)</span><br><span class="line">enemy = pygame.mixer.Sound(<span class="string">"resources/audio/enemy.wav"</span>)</span><br><span class="line">shoot = pygame.mixer.Sound(<span class="string">"resources/audio/shoot.wav"</span>)</span><br><span class="line">hit.set_volume(<span class="number">0.05</span>)</span><br><span class="line">enemy.set_volume(<span class="number">0.05</span>)</span><br><span class="line">shoot.set_volume(<span class="number">0.05</span>)</span><br><span class="line">pygame.mixer.music.load(<span class="string">'resources/audio/moonlight.wav'</span>)</span><br><span class="line">pygame.mixer.music.play(<span class="number">-1</span>, <span class="number">0.0</span>)</span><br><span class="line">pygame.mixer.music.set_volume(<span class="number">0.25</span>)</span><br></pre></td></tr></table></figure>
<p>以上代码大部分仅仅是加载音频文件并配置音频音量级别。但是请注意<code>pygame.mixer.music.load</code>行 —— 该行加载游戏的背景音乐，下一行将背景音乐设置为重复。</p>
<p>还需要处理音频配置。 ：] 现在你需要做的就是根据需要播放各种音效。按照以下代码的注释中的说明进行操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.3.1 if badrect.left&lt;64 之后:</span></span><br><span class="line">hit.play()</span><br><span class="line"><span class="comment"># 6.3.2 if badrect.colliderect(bullrect) 之后:</span></span><br><span class="line">enemy.play()</span><br><span class="line"><span class="comment"># 8, if event.type==pygame.MOUSEBUTTONDOWN 之后:</span></span><br><span class="line">shoot.play()</span><br></pre></td></tr></table></figure>
<p>再次运行游戏，你会注意到，你现在有了背景音乐和射击的音效。 游戏感觉更棒！ ：]</p>
<h2 id="接下来呢？"><a href="#接下来呢？" class="headerlink" title="接下来呢？"></a>接下来呢？</h2><p>你应该为自己感到自豪：你刚刚完成了一个有趣的游戏，包括音乐，声音，杀手级的兔子，凶恶的獾等等。 我告诉过你，你可以做到！ ：]</p>
<p>您可以在<a href="http://hipython.us/game.zip" target="_blank" rel="noopener">这里</a>下载游戏的最终源代码。</p>
<p>在这个基础上，您可以任意将这个游戏扩展到你自己的创作中！ 也许尝试用自己的照片替换背景，或者添加不同的武器或类型的怪物！</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"># python</a>
              <a href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag"># 游戏</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/04/10/170410-game-hangman/" rel="prev" title="猜单词游戏[难度:低]">
      <i class="fa fa-chevron-left"></i> 猜单词游戏[难度:低]
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/04/30/170430-how-to-read-a-book/" rel="next" title="如何阅读一本书">
      如何阅读一本书 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#开始：安装Python"><span class="nav-number">1.</span> <span class="nav-text">开始：安装Python</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行存储在文件中的Python代码"><span class="nav-number">2.</span> <span class="nav-text">运行存储在文件中的Python代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加游戏资源"><span class="nav-number">3.</span> <span class="nav-text">添加游戏资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第一步：哈罗，兔子！"><span class="nav-number">4.</span> <span class="nav-text">第一步：哈罗，兔子！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二步：添加舞台布景"><span class="nav-number">5.</span> <span class="nav-text">第二步：添加舞台布景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三步：让兔子动起来"><span class="nav-number">6.</span> <span class="nav-text">第三步：让兔子动起来</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四步：旋转玩家"><span class="nav-number">7.</span> <span class="nav-text">第四步：旋转玩家</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第五步：射击，兔子，射击！"><span class="nav-number">8.</span> <span class="nav-text">第五步：射击，兔子，射击！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第六步：拿起武器！獾！"><span class="nav-number">9.</span> <span class="nav-text">第六步：拿起武器！獾！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第七步：獾与箭的碰撞"><span class="nav-number">10.</span> <span class="nav-text">第七步：獾与箭的碰撞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第八步：添加健康计时器和时钟"><span class="nav-number">11.</span> <span class="nav-text">第八步：添加健康计时器和时钟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第九步：胜利或失败"><span class="nav-number">12.</span> <span class="nav-text">第九步：胜利或失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第十步：音乐和声音效果！"><span class="nav-number">13.</span> <span class="nav-text">第十步：音乐和声音效果！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接下来呢？"><span class="nav-number">14.</span> <span class="nav-text">接下来呢？</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fanzhh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">155</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fanzhh</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
